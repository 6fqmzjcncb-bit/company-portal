<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>√úr√ºn ve Stok Y√∂netimi</title>
    <link rel="stylesheet" href="/css/style.css?v=2.2">
    <link rel="stylesheet" href="/css/custom-dropdown.css">
    <!-- Flatpickr Date Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="css/custom-datepicker.css">
    <link rel="stylesheet" href="/css/modal.css?v=2.2">
    <!-- Inline CSS for Tabs -->
    <style>
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--gray-300);
            padding-bottom: 0px;
        }

        /* Error Handler Styles - Removed for production */

        .tab-btn {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: var(--gray-500);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            flex: 1;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: var(--primary-color);
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            font-weight: 600;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>

    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon">üè¢</span>
                ≈ûirket Portalƒ±
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/dashboard.html" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        Ana Sayfa
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/jobs.html" class="nav-link">
                        <span class="nav-icon">üìã</span>
                        ƒ∞≈ü Listeleri
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/sources.html" class="nav-link">
                        <span class="nav-icon">üì¶</span>
                        Kaynaklar
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/products.html" class="nav-link active">
                        <span class="nav-icon">üîß</span>
                        √úr√ºnler
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/attendance.html" class="nav-link">
                        <span class="nav-icon">üìÖ</span>
                        √áalƒ±≈üma Kaydƒ±
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/salary.html" class="nav-link">
                        <span class="nav-icon">üí∞</span>
                        Maa≈ü Y√∂netimi
                    </a>
                </li>

                <li class="nav-item" id="adminLink">
                    <a href="/admin.html" class="nav-link">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        Y√∂netim
                    </a>
                </li>
            </ul>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">üë§</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Sistem Y√∂neticisi</div>
                        <div class="user-role" id="userRole">üëë Y√∂netici</div>
                    </div>
                </div>
                <button class="btn-logout" onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </aside>

        <main class="main-content">
            <button id="sidebarToggle" class="btn-icon mobile-only">‚ò∞</button>
            <div class="page-header">
                <h1 class="page-title">√úr√ºn ve Stok Y√∂netimi</h1>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <!-- UNIFIED SINGLE BUTTON -->
                    <button onclick="openUnifiedModal()" class="btn btn-primary"
                        style="font-size: 1.1rem; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                        ‚ö° Hƒ±zlƒ± Stok ƒ∞≈ülemi
                    </button>
                </div>
            </div>

            <!-- TABS -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="tab-products">üìã √úr√ºn Listesi</button>
                <button class="tab-btn" data-tab="tab-movements">üìä Stok Hareketleri</button>
            </div>

            <!-- TAB 1: Products List -->
            <div id="tab-products" class="tab-content" style="display: block;">

                <div class="filter-container">
                    <select id="brandFilter" class="form-select brand-filter" data-custom-dropdown
                        data-searchable="true" data-placeholder="T√ºm Markalar">
                        <option value="">T√ºm Markalar</option>
                        <!-- Populated by JS -->
                    </select>
                    <div class="search-wrapper">
                        <input type="text" id="productSearch" class="form-input search-input"
                            placeholder="üîç √úr√ºn Ara (Ad veya Barkod)...">
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>√úr√ºn Adƒ±</th>
                                <th>Barkod</th>
                                <th>Marka</th>
                                <th>Stok</th>
                                <th>Birim</th>
                                <th>Eklenme Tarihi</th>
                            </tr>
                        </thead>
                        <tbody id="productsContainer">
                            <tr>
                                <td colspan="6" class="text-center">
                                    <div class="loader"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="alert alert-warning mt-3">
                    ‚ÑπÔ∏è Stok miktarlarƒ± sadece y√∂neticiler tarafƒ±ndan g√∂r√ºlebilir.
                </div>
            </div>

            <!-- TAB 2: Stock Movements -->
            <div id="tab-movements" class="tab-content">
                <!-- Filters -->
                <!-- Filters -->
                <!-- Filters -->
                <div class="stock-filters-wrapper"
                    style="display: flex; flex-wrap: wrap; align-items: center; gap: 15px;">
                    <!-- 1. Transaction Type -->
                    <div style="flex: 1; min-width: 140px;">
                        <select id="filterType" class="form-select" data-custom-dropdown data-searchable="false"
                            data-placeholder="ƒ∞≈ülem Tipi" style="border-radius: 8px !important;">
                            <option value="">T√ºm√º</option>
                            <option value="IN">Stok Giri≈üi</option>
                            <option value="OUT">Stok √áƒ±kƒ±≈üƒ±</option>
                        </select>
                    </div>

                    <!-- 2. Product Search (Autocomplete) -->
                    <div style="flex: 2; min-width: 200px; position: relative;">
                        <input type="text" id="productSearchMovements" class="form-input"
                            placeholder="√úr√ºn Ara (Ad veya Barkod)..." autocomplete="off"
                            style="border-radius: 8px !important; padding-left: 35px; padding-right: 30px; background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' fill=\'none\' viewBox=\'0 0 24 24\' stroke=\'%239ca3af\'%3E%3Cpath stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'2\' d=\'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\'/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: 10px center; background-size: 18px;">
                        <!-- Clear Button inside input -->
                        <div id="clearProductSearchBtn"
                            style="display: none; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #9ca3af; padding: 5px;">
                            <svg xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 16px;" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </div>
                    </div>

                    <!-- 3. Start Date -->
                    <div style="flex: 1; min-width: 140px;">
                        <input type="date" id="filterStartDate" class="form-input" placeholder="Ba≈ülangƒ±√ß">
                    </div>

                    <!-- 4. End Date -->
                    <div style="flex: 1; min-width: 140px;">
                        <input type="date" id="filterEndDate" class="form-input" placeholder="Biti≈ü">
                    </div>

                    <!-- 5. Buttons -->
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-primary" onclick="loadMovements()"
                            style="padding: 10px 20px; height: 48px; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 1.1rem;">üîç</span>
                        </button>
                        <button class="btn btn-secondary" onclick="clearFilters()"
                            style="padding: 10px 15px; height: 48px; display: flex; align-items: center; justify-content: center;"
                            title="Temizle">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>

                <style>
                    /* FORCE BOX STYLING FOR STOCK MOVEMENTS FILTERS */
                    /* Target the new wrapper to ensure specificity */
                    .stock-filters-wrapper .custom-dropdown-trigger {
                        border-radius: 8px !important;
                        border: 1px solid #d1d5db !important;
                        /* gray-300 */
                        background-color: #fff !important;
                        height: 48px !important;
                        /* Force equal height */
                        display: flex;
                        align-items: center;
                    }

                    /* Apply 48px height to ALL inputs in this wrapper (Search, Date) */
                    .stock-filters-wrapper .form-input {
                        border-radius: 8px !important;
                        border: 1px solid #d1d5db !important;
                        height: 48px !important;
                        /* Force equal height */
                        padding-top: 0 !important;
                        padding-bottom: 0 !important;
                        line-height: 48px !important;
                    }

                    /* Specific fix for Search Input alignment */
                    .stock-filters-wrapper #productSearchMovements::placeholder {
                        line-height: normal;
                    }
                </style>

                <!-- Table -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Tarih</th>
                                <th>ƒ∞≈ülem</th>
                                <th>√úr√ºn</th>
                                <th>Miktar</th>
                                <th>Ki≈üi</th>
                                <th>Konum</th>
                                <th>A√ßƒ±klama</th>
                            </tr>
                        </thead>
                        <tbody id="movementList">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- ADD PRODUCT MODAL -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="productModalTitle">‚ú® Yeni √úr√ºn Ekle</h2>
                <button class="modal-close" onclick="closeModals()">√ó</button>
            </div>
            <form id="addProductForm">
                <input type="hidden" id="editProdId">
                <div class="form-group">
                    <label class="form-label">√úr√ºn Adƒ±</label>
                    <input type="text" id="newProdName" class="form-input" required placeholder="√ñrn: √áimento">
                </div>
                <div class="form-group">
                    <label class="form-label">Marka</label>
                    <input type="text" id="newProdBrand" class="form-input" placeholder="√ñrn: Fƒ±rat"
                        list="brandOptions">
                    <datalist id="brandOptions"></datalist>
                </div>
                <div class="form-group">
                    <label class="form-label">Barkod (ƒ∞steƒüe baƒülƒ±)</label>
                    <input type="text" id="newProdBarcode" class="form-input" placeholder="Barkod okutun veya yazƒ±n">
                </div>
                <div class="form-group">
                    <label for="newProdStock">Ba≈ülangƒ±√ß Stok</label>
                    <input type="number" id="newProdStock" class="form-input" step="0.01" required
                        placeholder="Miktar giriniz...">
                </div>

                <div class="form-group">
                    <label for="newProdDate">Kayƒ±t Tarihi</label>
                    <input type="date" id="newProdDate" class="form-input" required
                        style="min-width: 180px; font-size: 1rem; padding: 10px 12px;">
                </div>

                <div class="form-group">
                    <label class="form-label">Birim</label>
                    <select id="newProdUnit" class="form-input">
                        <option value="" disabled selected>Birim Se√ßin</option>
                    </select>
                </div>

                <!-- Product History Section -->
                <div id="modalProductHistory"
                    style="display: none; margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h3 style="font-size: 1rem; margin: 0; color: #666;">Son Hareketler</h3>
                        <button type="button" id="showAllMovementsBtn" onclick="showAllProductMovements()"
                            style="background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; cursor: pointer; font-weight: 600;">
                            üìä T√ºm√ºn√º G√∂ster
                        </button>
                    </div>
                    <div class="table-container" style="max-height: 200px; overflow-y: auto;">
                        <table style="font-size: 0.85rem;">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>ƒ∞≈ülem</th>
                                    <th>Miktar</th>
                                    <th>Ki≈üi</th>
                                </tr>
                            </thead>
                            <tbody id="modalHistoryBody">
                                <!-- Filled by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="modal-actions" style="justify-content: space-between;">
                    <button type="button" id="btnDeleteProduct" class="btn btn-danger" style="display:none;"
                        onclick="deleteProduct()">Sil</button>
                    <div style="display:flex; gap:10px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModals()">ƒ∞ptal</button>
                        <button type="submit" class="btn btn-primary">Kaydet</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- STOCK IN MODAL -->
    <div id="stockInModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì• Stok Giri≈üi Yap</h2>
                <button class="modal-close" onclick="closeModals()">√ó</button>
            </div>
            <form id="stockInForm">
                <div class="form-group">
                    <label class="form-label">√úr√ºn Se√ßin</label>
                    <input type="text" id="inProduct" class="form-input"
                        placeholder="√úr√ºn adƒ± veya barkod ile arayƒ±n..." list="productOptions" required
                        autocomplete="off">
                    <datalist id="productOptions">
                        <!-- Populated by JS -->
                    </datalist>
                </div>
                <div class="form-group">
                    <label class="form-label">Miktar</label>
                    <input type="number" id="inQuantity" class="form-input" min="1" required placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Getiren / Teslim Eden</label>
                    <input type="text" id="inBroughtBy" class="form-input" placeholder="Personel se√ßin veya isim yazƒ±n"
                        list="employeeOptions" required autocomplete="off">
                    <datalist id="employeeOptions">
                        <!-- Populated by JS -->
                    </datalist>
                </div>
                <div class="form-group">
                    <label class="form-label">Kaynak (Nereden Geldi?)</label>
                    <input type="text" id="inSource" class="form-input" placeholder="Kaynak se√ßin veya yazƒ±n"
                        list="sourceOptions" autocomplete="off">
                    <datalist id="sourceOptions">
                        <!-- Populated by JS -->
                    </datalist>
                </div>
                <div class="form-group">
                    <label class="form-label">Notlar</label>
                    <textarea id="inNotes" class="form-input" rows="2"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModals()">ƒ∞ptal</button>
                    <button type="button" class="btn btn-success" onclick="submitStockIn()">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- STOCK OUT MODAL -->
    <div id="stockOutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì§ Stok √áƒ±kƒ±≈üƒ± Yap</h2>
                <button class="modal-close" onclick="closeModals()">√ó</button>
            </div>
            <form id="stockOutForm">
                <div class="form-group">
                    <label class="form-label">√úr√ºn Se√ßin</label>
                    <input type="text" id="outProduct" class="form-input"
                        placeholder="√úr√ºn adƒ± veya barkod ile arayƒ±n..." list="productOptions" required
                        autocomplete="off">
                    <!-- Reuses productOptions datalist from stock-in modal -->
                </div>
                <div class="form-group">
                    <label class="form-label">Miktar</label>
                    <input type="number" id="outQuantity" class="form-input" min="1" required placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Alan Ki≈üi</label>
                    <input type="text" id="outTakenBy" class="form-input" placeholder="ƒ∞sim soyisim" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Gideceƒüi Yer</label>
                    <input type="text" id="outDestination" class="form-input" placeholder="Proje veya konum">
                </div>
                <div class="form-group">
                    <label class="form-label">Sebep</label>
                    <input type="text" id="outReason" class="form-input" placeholder="Sebep yazƒ±n" list="reasonOptions"
                        autocomplete="off">
                    <datalist id="reasonOptions">
                        <option value="ƒ∞≈ü Kullanƒ±mƒ±">
                        <option value="Satƒ±≈ü">
                        <option value="Fire/Zayi">
                        <option value="Diƒüer">
                    </datalist>
                </div>
                <div class="form-group">
                    <label class="form-label">Notlar</label>
                    <textarea id="outNotes" class="form-input" rows="2"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModals()">ƒ∞ptal</button>
                    <button type="button" class="btn btn-danger" onclick="submitStockOut()">√áƒ±kƒ±≈ü Yap</button>
                </div>
            </form>
        </div>
    </div>

    <!-- UNIFIED STOCK MODAL (Invoice Style) -->
    <div id="unifiedStockModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ö° Toplu Stok ƒ∞≈ülemi</h2>
                <span class="close" onclick="closeModals()">&times;</span>
            </div>

            <div class="modal-body">
                <!-- MODE SELECTION -->
                <div
                    style="display: flex; flex-direction: row; gap: 15px; width: 100%; margin-bottom: 25px; box-sizing: border-box;">
                    <button id="batchModeIn" onclick="setBatchMode('in')" class="btn btn-success"
                        style="display: flex !important; flex: 1 1 0% !important; justify-content: center !important; align-items: center !important; padding: 14px 0 !important; font-size: 1.05rem !important; font-weight: 600 !important; box-sizing: border-box !important; margin: 0 !important;">
                        üì• √úr√ºn Giri≈ü
                    </button>
                    <button id="batchModeOut" onclick="setBatchMode('out')" class="btn btn-danger"
                        style="display: flex !important; flex: 1 1 0% !important; justify-content: center !important; align-items: center !important; padding: 14px 0 !important; font-size: 1.05rem !important; font-weight: 600 !important; box-sizing: border-box !important; margin: 0 !important;">
                        üì§ √úr√ºn √áƒ±kƒ±≈ü
                    </button>
                </div>

                <!-- ADD PRODUCT SECTION (MOVED TO TOP) -->
                <div id="batchAddSection"
                    style="display: none; background: #f0f9ff; padding: 20px; border-radius: 10px; border: 2px dashed #3b82f6; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; color: #1e40af; font-size: 1.05rem;">‚ûï Yeni √úr√ºn Ekle</h4>

                    <div class="form-group">
                        <label>√úr√ºn Ara</label>
                        <div style="position: relative; flex: 1; display: flex;">
                            <input type="text" id="batchProductSearch" class="form-input"
                                placeholder="√úr√ºn adƒ± veya barkod..." autocomplete="off"
                                oninput="handleBatchProductSearch(this.value)"
                                style="width: 100%; padding-right: 40px;">
                            <button type="button" id="batchProductClearBtn" onclick="clearBatchProductSelection()"
                                style="display: none; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: #fee2e2; border: none; color: #ef4444; width: 26px; height: 26px; border-radius: 50%; justify-content: center; align-items: center; cursor: pointer; font-size: 14px; font-weight: bold; box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);">
                                ‚úï
                            </button>
                        </div>
                        <div id="batchProductSuggestions" class="autocomplete-items"></div>
                    </div>

                    <div class="form-group">
                        <label>Miktar</label>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <input type="number" id="batchQuantity" class="form-input" placeholder="0"
                                style="width: 120px; flex-shrink: 0; font-size: 1.1rem; font-weight: 600; text-align: center;">
                            <span id="batchQuantityUnit"
                                style="color: #374151; font-weight: 700; font-size: 1.1rem; min-width: 50px;">-</span>
                            <span id="batchUnitLabel"
                                style="margin-left: auto; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 12px 20px; border-radius: 10px; font-weight: 700; font-size: 0.95rem; white-space: nowrap; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); border: 2px solid #1d4ed8; min-width: 160px; text-align: center;">Stok:
                                -</span>
                        </div>
                    </div>

                    <div style="text-align: right;">
                        <button type="button" onclick="addProductToBatch()" class="btn btn-primary"
                            style="padding: 10px 25px; font-weight: 600; width: 100%; display: flex; justify-content: center; align-items: center;">
                            ‚ûï Ekle
                        </button>
                    </div>
                </div>

                <!-- ADDED PRODUCTS TABLE -->
                <div id="batchProductsSection" style="display: none; margin-bottom: 25px;">
                    <h4 style="margin: 0 0 12px 0; color: #374151; font-size: 1.1rem;">Eklenmi≈ü √úr√ºnler (<span
                            id="batchCount">0</span>)</h4>
                    <div
                        style="border: 2px solid #e5e7eb; border-radius: 10px; overflow: hidden; max-height: 300px; overflow-y: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #f3f4f6; position: sticky; top: 0;">
                                <tr>
                                    <th
                                        style="padding: 12px; text-align: left; font-weight: 600; color: #6b7280; border-bottom: 2px solid #e5e7eb;">
                                        √úr√ºn</th>
                                    <th
                                        style="padding: 12px; text-align: center; font-weight: 600; color: #6b7280; border-bottom: 2px solid #e5e7eb; width: 120px;">
                                        Miktar</th>
                                    <th
                                        style="padding: 12px; text-align: center; font-weight: 600; color: #6b7280; border-bottom: 2px solid #e5e7eb; width: 80px;">
                                        Birim</th>
                                    <th
                                        style="padding: 12px; text-align: center; font-weight: 600; color: #6b7280; border-bottom: 2px solid #e5e7eb; width: 60px;">
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="batchProductsTable">
                                <tr>
                                    <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af;">
                                        Hen√ºz √ºr√ºn eklenmedi
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- COMMON FIELDS -->
                <div id="batchCommonFields"
                    style="display: none; background: #f9fafb; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                    <h4 style="margin: 0 0 15px 0; color: #374151; font-size: 1.1rem;">Ortak Bilgiler (T√ºm √úr√ºnler ƒ∞√ßin)
                    </h4>

                    <div class="form-group">
                        <label>Tarih</label>
                        <input type="date" id="batchDate" class="form-input" required
                            style="min-width: 180px; width: 100%; font-size: 1rem; padding: 10px 12px; background-color: #ffffff !important; box-sizing: border-box;">
                    </div>

                    <div class="form-group">
                        <label>Personel</label>
                        <select id="batchEmployee" class="form-select" data-custom-dropdown data-searchable="true"
                            data-placeholder="Personel adƒ± se√ßin...">
                            <option value="">Personel adƒ± se√ßin...</option>
                        </select>
                    </div>

                    <div id="batchSourceField" class="form-group" style="display: none;">
                        <label>Kaynak (Tedarik√ßi/Firma)</label>
                        <select id="batchSource" class="form-select" data-custom-dropdown="true" data-searchable="true"
                            data-allow-new="true" data-placeholder="Kaynak se√ßin veya yazƒ±n...">
                            <option value="">Kaynak se√ßin veya yazƒ±n...</option>
                        </select>
                    </div>

                    <div id="batchProjectField" class="form-group" style="display: none;">
                        <label>Proje Adƒ±</label>
                        <input type="text" id="batchProject" class="form-input" placeholder="Hangi i≈ü i√ßin?">
                    </div>
                </div>

                <!-- NOTES & SAVE (AT BOTTOM) -->
                <div id="batchSaveSection" style="display: none;">
                    <div class="form-group">
                        <label>Notlar (Opsiyonel)</label>
                        <textarea id="batchNotes" class="form-textarea" rows="2"
                            placeholder="T√ºm √ºr√ºnler i√ßin ortak not..."></textarea>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button type="button" onclick="submitBatch()" class="btn btn-success"
                            style="padding: 16px 50px; font-size: 1.15rem; font-weight: 600; width: 100%; display: flex; justify-content: center; align-items: center;">
                            üíæ Kaydet (<span id="batchSaveCount">0</span> √ºr√ºn)
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- STEP 3: CREATE NEW (Hidden) -->
    <div id="unifiedCreateSection" style="display: none; margin-top: 20px; text-align: center;">
        <p style="color: #ef4444; font-weight: bold;">Bu √ºr√ºn sistemde bulunamadƒ±.</p>
        <button class="btn btn-primary" onclick="switchToCreateMode()">+ Yeni √úr√ºn Olu≈ütur</button>
    </div>

    </div>
    </div>
    </div>

    <!-- Custom Alert Overlay -->
    <div id="customAlertOverlay"
        style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 10000; justify-content: center; align-items: center;">
        <div id="customAlertBox"
            style="background: white; border-radius: 16px; padding: 35px; max-width: 420px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.4); animation: slideIn 0.3s ease-out;">
            <div id="customAlertIcon" style="font-size: 4rem; margin-bottom: 15px;">‚úÖ</div>
            <h3 id="customAlertTitle" style="margin: 0 0 10px 0; color: #1f2937; font-size: 1.5rem;">Ba≈üarƒ±lƒ±!</h3>
            <p id="customAlertMessage" style="color: #6b7280; margin-bottom: 25px; font-size: 1rem;">ƒ∞≈ülem tamamlandƒ±.
            </p>
            <button onclick="closeCustomAlert()" class="btn btn-primary"
                style="padding: 14px 40px; font-size: 1.05rem; border-radius: 8px;">Tamam</button>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cartSidebar"
        style="position: fixed; right: -420px; top: 0; bottom: 0; width: 420px; background: white; box-shadow: -5px 0 25px rgba(0,0,0,0.3); transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 9999; overflow-y: auto; display: flex; flex-direction: column;">
        <div
            style="padding: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; flex-shrink: 0;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="margin: 0; font-size: 1.4rem;">üõí ƒ∞≈ülem Sepeti</h3>
                    <p style="margin: 8px 0 0 0; font-size: 0.95rem; opacity: 0.9;" id="cartCount">0 √ºr√ºn</p>
                </div>
                <button onclick="toggleCart(false)"
                    style="background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 50%; width: 36px; height: 36px; font-size: 1.3rem; cursor: pointer;">√ó</button>
            </div>
        </div>
        <div id="cartItems" style="padding: 20px; flex: 1; overflow-y: auto;"></div>
        <div style="padding: 20px; border-top: 2px solid #e5e7eb; background: #f9fafb; flex-shrink: 0;">
            <button onclick="processCart()" class="btn btn-success"
                style="width: 100%; padding: 16px; font-size: 1.15rem; font-weight: 600; border-radius: 10px; margin-bottom: 12px;">üíæ
                T√ºm√ºn√º Kaydet</button>
            <button onclick="clearCart()" class="btn btn-outline-danger"
                style="width: 100%; padding: 12px; border-radius: 8px;">üóëÔ∏è Sepeti Temizle</button>
        </div>
    </div>

    <!-- Cart Toggle Button -->
    <button id="cartToggleBtn" onclick="toggleCart(true)"
        style="position: fixed; right: 25px; bottom: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50%; width: 70px; height: 70px; font-size: 1.8rem; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5); cursor: pointer; z-index: 9998; display: none; transition: transform 0.2s; align-items: center; justify-content: center;">
        üõí
        <span id="cartBadge"
            style="position: absolute; top: -8px; right: -8px; background: #ef4444; border-radius: 50%; min-width: 28px; height: 28px; font-size: 0.85rem; display: flex; align-items: center; justify-content: center; font-weight: bold; padding: 0 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">0</span>
    </button>

    <style>
        @keyframes slideIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        #cartToggleBtn:hover {
            transform: scale(1.1);
        }
    </style>

    <script src="/js/utils.js?v=7.3"></script>
    <!-- Custom Dropdown Component -->
    <script src="/js/custom-dropdown.js"></script>
    <script src="/js/products_v2.js?v=7.6"></script>

    <!-- Flatpickr Date Picker Library -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/tr.js"></script>

    <script>
        // Initialize Flatpickr for batch date input
        document.addEventListener('DOMContentLoaded', function () {
            const batchDateInput = document.getElementById('batchDate');
            if (batchDateInput) {
                window.batchDateFlatpickr = flatpickr(batchDateInput, {
                    locale: 'tr',
                    dateFormat: 'Y-m-d', // Backend format (hidden input)
                    altInput: true,
                    altFormat: 'd F Y', // Display format: 11 ≈ûubat 2026
                    defaultDate: 'today',
                    allowInput: true,
                    clickOpens: true,
                    static: true,
                    monthSelectorType: 'static',
                    inline: false,
                    position: 'below left',
                    positionElement: batchDateInput
                });
            }

            // Initialize Flatpickr for filter dates
            const filterStartInput = document.getElementById('filterStartDate');
            if (filterStartInput) {
                flatpickr(filterStartInput, {
                    locale: 'tr',
                    dateFormat: 'Y-m-d',
                    altInput: true,
                    altFormat: 'd.m.Y',
                    defaultDate: 'today',
                    allowInput: true,
                    clickOpens: true,
                    static: true,
                    monthSelectorType: 'static',
                    inline: false,
                    position: 'below left'
                });
            }

            const filterEndInput = document.getElementById('filterEndDate');
            if (filterEndInput) {
                flatpickr(filterEndInput, {
                    locale: 'tr',
                    dateFormat: 'Y-m-d',
                    altInput: true,
                    altFormat: 'd.m.Y',
                    defaultDate: 'today',
                    allowInput: true,
                    clickOpens: true,
                    static: true,
                    monthSelectorType: 'static',
                    inline: false,
                    position: 'below left'
                });
            }
        });
    </script>
</body>

</html>
<script>
    // Initialize Flatpickr for product registration date
    document.addEventListener('DOMContentLoaded', function () {
        const newProdDateInput = document.getElementById('newProdDate');
        if (newProdDateInput) {
            window.newProdDateFlatpickr = flatpickr(newProdDateInput, {
                locale: 'tr',
                dateFormat: 'Y-m-d', // Backend format
                altInput: true,
                altFormat: 'd F Y', // Display: 11 ≈ûubat 2026
                defaultDate: 'today',
                allowInput: true,
                clickOpens: true,
                static: true,
                monthSelectorType: 'static',
                inline: false,
                position: 'below left',
                onChange: function (selectedDates, dateStr, instance) {
                    if (!dateStr) {
                        instance.setDate('today');
                    }
                }
            });

            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            newProdDateInput.value = today;
        }
    });
</script>