<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√úr√ºnler ve Stok - ≈ûirket Portalƒ±</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/modal.css">
    <!-- Inline CSS for Tabs -->
    <style>
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--gray-300);
            padding-bottom: 0px;
        }

        /* Error Handler Styles - Removed for production */

        .tab-btn {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: var(--gray-500);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: var(--primary-color);
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            font-weight: 600;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>

    <div class="app-container">
        <aside class="sidebar">
            <div class="logo"><span class="logo-icon">üè¢</span>≈ûirket Portalƒ±</div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="/dashboard.html" class="nav-link"><span class="nav-icon">üìä</span>Ana
                        Sayfa</a></li>
                <li class="nav-item"><a href="/jobs.html" class="nav-link"><span class="nav-icon">üìã</span>ƒ∞≈ü
                        Listeleri</a></li>
                <li class="nav-item"><a href="/sources.html" class="nav-link"><span
                            class="nav-icon">üì¶</span>Kaynaklar</a></li>
                <li class="nav-item">
                    <a href="/products.html" class="nav-link active">
                        <span class="nav-icon">üîß</span>
                        √úr√ºnler
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/attendance.html" class="nav-link">
                        <span class="nav-icon">üìÖ</span>
                        √áalƒ±≈üma Kaydƒ±
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/salary.html" class="nav-link">
                        <span class="nav-icon">üí∞</span>
                        Maa≈ü Y√∂netimi
                    </a>
                </li>
                <li class="nav-item" id="adminLink" style="display: none;"><a href="/admin.html" class="nav-link"><span
                            class="nav-icon">‚öôÔ∏è</span>Y√∂netim</a></li>
            </ul>
            <div class="user-info">
                <div class="user-name" id="userName">...</div>
                <div class="user-role" id="userRole"></div>
                <button class="btn btn-secondary btn-sm btn-block" onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">√úr√ºn ve Stok Y√∂netimi</h1>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <!-- UNIFIED SINGLE BUTTON -->
                    <button onclick="openUnifiedModal()" class="btn btn-primary"
                        style="font-size: 1.1rem; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                        ‚ö° Hƒ±zlƒ± Stok ƒ∞≈ülemi
                    </button>
                </div>
            </div>

            <!-- TABS -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="tab-products">üìã √úr√ºn Listesi</button>
                <button class="tab-btn" data-tab="tab-movements">üìä Stok Hareketleri</button>
            </div>

            <!-- TAB 1: Products List -->
            <div id="tab-products" class="tab-content" style="display: block;">

                <div class="filter-container">
                    <select id="brandFilter" class="form-select brand-filter">
                        <option value="">T√ºm Markalar</option>
                        <!-- Populated by JS -->
                    </select>
                    <div class="search-wrapper">
                        <input type="text" id="productSearch" class="form-input search-input"
                            placeholder="üîç √úr√ºn Ara (Ad veya Barkod)...">
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>√úr√ºn Adƒ±</th>
                                <th>Barkod</th>
                                <th>Marka</th>
                                <th>Stok</th>
                                <th>Birim</th>
                                <th>Eklenme Tarihi</th>
                            </tr>
                        </thead>
                        <tbody id="productsContainer">
                            <tr>
                                <td colspan="6" class="text-center">
                                    <div class="loader"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="alert alert-warning mt-3">
                    ‚ÑπÔ∏è Stok miktarlarƒ± sadece y√∂neticiler tarafƒ±ndan g√∂r√ºlebilir.
                </div>
            </div>

            <!-- TAB 2: Stock Movements -->
            <div id="tab-movements" class="tab-content">
                <!-- Filters -->
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row" style="display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap;">
                            <div class="col" style="flex: 1; min-width: 200px;">
                                <label class="form-label">√úr√ºn</label>
                                <select id="filterProduct" class="form-select">
                                    <option value="">T√ºm√º</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div class="col" style="flex: 1; min-width: 150px;">
                                <label class="form-label">ƒ∞≈ülem Tipi</label>
                                <select id="filterType" class="form-select">
                                    <option value="">T√ºm√º</option>
                                    <option value="IN">Stok Giri≈üi</option>
                                    <option value="OUT">Stok √áƒ±kƒ±≈üƒ±</option>
                                </select>
                            </div>
                            <div class="col" style="flex: 1; min-width: 150px;">
                                <label class="form-label">Ba≈ülangƒ±√ß</label>
                                <input type="date" id="filterStartDate" class="form-input">
                            </div>
                            <div class="col" style="flex: 1; min-width: 150px;">
                                <label class="form-label">Biti≈ü</label>
                                <input type="date" id="filterEndDate" class="form-input">
                            </div>
                            <div class="col">
                                <button class="btn btn-primary" onclick="loadMovements()">Filtrele</button>
                                <button class="btn btn-secondary" onclick="clearFilters()">Temizle</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Table -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Tarih</th>
                                <th>ƒ∞≈ülem</th>
                                <th>√úr√ºn</th>
                                <th>Miktar</th>
                                <th>Ki≈üi</th>
                                <th>Konum</th>
                                <th>A√ßƒ±klama</th>
                            </tr>
                        </thead>
                        <tbody id="movementList">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- ADD PRODUCT MODAL -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="productModalTitle">‚ú® Yeni √úr√ºn Ekle</h2>
                <button class="modal-close" onclick="closeModals()">√ó</button>
            </div>
            <form id="addProductForm">
                <input type="hidden" id="editProdId">
                <div class="form-group">
                    <label class="form-label">√úr√ºn Adƒ±</label>
                    <input type="text" id="newProdName" class="form-input" required placeholder="√ñrn: √áimento">
                </div>
                <div class="form-group">
                    <label class="form-label">Marka</label>
                    <input type="text" id="newProdBrand" class="form-input" placeholder="√ñrn: Fƒ±rat"
                        list="brandOptions">
                    <datalist id="brandOptions"></datalist>
                </div>
                <div class="form-group">
                    <label class="form-label">Barkod (ƒ∞steƒüe baƒülƒ±)</label>
                    <input type="text" id="newProdBarcode" class="form-input" placeholder="Barkod okutun veya yazƒ±n">
                </div>
                <div class="form-group">
                    <label class="form-label">Ba≈ülangƒ±√ß Stok</label>
                    <input type="number" id="newProdStock" class="form-input" placeholder="0" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Birim</label>
                    <select id="newProdUnit" class="form-input">
                        <option value="adet">Adet</option>
                        <option value="metre">Metre</option>
                        <option value="kg">Kg</option>
                        <option value="paket">Paket</option>
                        <option value="takƒ±m">Takƒ±m</option>
                    </select>
                </div>

                <!-- Product History Section -->
                <div id="modalProductHistory"
                    style="display: none; margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
                    <h3 style="font-size: 1rem; margin-bottom: 10px; color: #666;">Son 5 Hareket</h3>
                    <div class="table-container" style="max-height: 150px; overflow-y: auto;">
                        <table style="font-size: 0.85rem;">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>ƒ∞≈ülem</th>
                                    <th>Miktar</th>
                                    <th>Ki≈üi</th>
                                </tr>
                            </thead>
                            <tbody id="modalHistoryBody">
                                <!-- Filled by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="modal-actions" style="justify-content: space-between;">
                    <button type="button" id="btnDeleteProduct" class="btn btn-danger" style="display:none;"
                        onclick="deleteProduct()">Sil</button>
                    <div style="display:flex; gap:10px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModals()">ƒ∞ptal</button>
                        <button type="submit" class="btn btn-primary">Kaydet</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- STOCK IN MODAL -->
    <div id="stockInModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì• Stok Giri≈üi Yap</h2>
                <button class="modal-close" onclick="closeModals()">√ó</button>
            </div>
            <form id="stockInForm">
                <div class="form-group">
                    <label class="form-label">√úr√ºn Se√ßin</label>
                    <input type="text" id="inProduct" class="form-input"
                        placeholder="√úr√ºn adƒ± veya barkod ile arayƒ±n..." list="productOptions" required
                        autocomplete="off">
                    <datalist id="productOptions">
                        <!-- Populated by JS -->
                    </datalist>
                </div>
                <div class="form-group">
                    <label class="form-label">Miktar</label>
                    <input type="number" id="inQuantity" class="form-input" min="1" required placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Getiren / Teslim Eden</label>
                    <input type="text" id="inBroughtBy" class="form-input" placeholder="Personel se√ßin veya isim yazƒ±n"
                        list="employeeOptions" required autocomplete="off">
                    <datalist id="employeeOptions">
                        <!-- Populated by JS -->
                    </datalist>
                </div>
                <div class="form-group">
                    <label class="form-label">Kaynak (Nereden Geldi?)</label>
                    <input type="text" id="inSource" class="form-input" placeholder="Kaynak se√ßin veya yazƒ±n"
                        list="sourceOptions" autocomplete="off">
                    <datalist id="sourceOptions">
                        <!-- Populated by JS -->
                    </datalist>
                </div>
                <div class="form-group">
                    <label class="form-label">Notlar</label>
                    <textarea id="inNotes" class="form-input" rows="2"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModals()">ƒ∞ptal</button>
                    <button type="button" class="btn btn-success" onclick="submitStockIn()">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- STOCK OUT MODAL -->
    <div id="stockOutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì§ Stok √áƒ±kƒ±≈üƒ± Yap</h2>
                <button class="modal-close" onclick="closeModals()">√ó</button>
            </div>
            <form id="stockOutForm">
                <div class="form-group">
                    <label class="form-label">√úr√ºn Se√ßin</label>
                    <input type="text" id="outProduct" class="form-input"
                        placeholder="√úr√ºn adƒ± veya barkod ile arayƒ±n..." list="productOptions" required
                        autocomplete="off">
                    <!-- Reuses productOptions datalist from stock-in modal -->
                </div>
                <div class="form-group">
                    <label class="form-label">Miktar</label>
                    <input type="number" id="outQuantity" class="form-input" min="1" required placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Alan Ki≈üi</label>
                    <input type="text" id="outTakenBy" class="form-input" placeholder="ƒ∞sim soyisim" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Gideceƒüi Yer</label>
                    <input type="text" id="outDestination" class="form-input" placeholder="Proje veya konum">
                </div>
                <div class="form-group">
                    <label class="form-label">Sebep</label>
                    <input type="text" id="outReason" class="form-input" placeholder="Sebep yazƒ±n" list="reasonOptions"
                        autocomplete="off">
                    <datalist id="reasonOptions">
                        <option value="ƒ∞≈ü Kullanƒ±mƒ±">
                        <option value="Satƒ±≈ü">
                        <option value="Fire/Zayi">
                        <option value="Diƒüer">
                    </datalist>
                </div>
                <div class="form-group">
                    <label class="form-label">Notlar</label>
                    <textarea id="outNotes" class="form-input" rows="2"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModals()">ƒ∞ptal</button>
                    <button type="button" class="btn btn-danger" onclick="submitStockOut()">√áƒ±kƒ±≈ü Yap</button>
                </div>
            </form>
        </div>
    </div>

    <!-- UNIFIED STOCK MODAL -->
    <div id="unifiedStockModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>‚ö° Hƒ±zlƒ± Stok ƒ∞≈ülemi</h2>
                <span class="close" onclick="closeModals()">&times;</span>
            </div>

            <div class="modal-body">
                <!-- STEP 1: SEARCH -->
                <div class="form-group">
                    <label>√úr√ºn Ara (Barkod veya ƒ∞sim)</label>
                    <input type="text" id="unifiedSearchInput" class="form-control"
                        style="font-size: 1.2rem; padding: 15px;" placeholder="√úr√ºn adƒ± yazƒ±n..."
                        oninput="handleUnifiedSearch(this.value)">
                    <div id="unifiedSuggestions" class="autocomplete-items"></div>
                </div>

                <!-- STEP 2: ACTION SELECTION (Hidden initially) -->
                <div id="unifiedActionSection" style="display: none; margin-top: 20px;">

                    <!-- Product Info Bar -->
                    <div id="productInfoBar"
                        style="background: #eef2ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #c7d2fe;">
                        <h3 id="selectedProductName" style="margin: 0 0 5px 0; color: #3730a3;">√úr√ºn Adƒ±</h3>
                        <div style="display: flex; gap: 15px; font-size: 0.9rem; color: #5b21b6;">
                            <span>Mevcut Stok: <strong id="selectedProductStock">0</strong> <span
                                    id="selectedProductUnit">Adet</span></span>
                            <span>Marka: <strong id="selectedProductBrand">-</strong></span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div id="actionButtons" style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-success" onclick="setUnifiedMode('in')"
                            style="flex: 1; padding: 15px;">üì• Stok Ekle</button>
                        <button class="btn btn-danger" onclick="setUnifiedMode('out')"
                            style="flex: 1; padding: 15px;">üì§ Stok √áƒ±kar</button>
                    </div>

                    <!-- Transaction Form -->
                    <form id="unifiedTransactionForm"
                        style="display: none; background: #f9fafb; padding: 15px; border-radius: 8px;">
                        <input type="hidden" id="unifiedProductId">
                        <input type="hidden" id="unifiedTransactionType"> <!-- 'in' or 'out' -->

                        <div class="form-group">
                            <label>Miktar</label>
                            <div style="display: flex; align-items: center;">
                                <input type="number" id="unifiedQuantity" class="form-control" placeholder="0"
                                    style="border-top-right-radius: 0; border-bottom-right-radius: 0;">
                                <span id="unifiedUnitLabel"
                                    style="background: #e5e7eb; padding: 10px 15px; border: 1px solid #d1d5db; border-left: 0; border-top-right-radius: 4px; border-bottom-right-radius: 4px; color: #374151; font-weight: bold;">Adet</span>
                            </div>
                        </div>

                        <!-- Dynamic Fields based on Type -->
                        <div id="unifiedInFields" style="display: none;">
                            <div class="form-group">
                                <label>Getiren / Teslim Eden</label>
                                <input type="text" id="unifiedSource" class="form-control"
                                    placeholder="Tedarik√ßi veya Personel">
                            </div>
                        </div>

                        <div id="unifiedOutFields" style="display: none;">
                            <div class="form-group">
                                <label>Teslim Alan</label>
                                <input type="text" id="unifiedDestination" class="form-control"
                                    placeholder="Personel Adƒ±">
                            </div>
                            <div class="form-group">
                                <label>Hangi ƒ∞≈ü ƒ∞√ßin?</label>
                                <input type="text" id="unifiedReason" class="form-control" placeholder="Proje Adƒ±">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Notlar</label>
                            <textarea id="unifiedNotes" class="form-control"></textarea>
                        </div>

                        <button type="button" class="btn btn-primary" onclick="submitUnifiedTransaction()"
                            style="width: 100%; margin-top: 10px;">Kaydet</button>
                    </form>
                </div>

                <!-- STEP 3: CREATE NEW (Hidden) -->
                <div id="unifiedCreateSection" style="display: none; margin-top: 20px; text-align: center;">
                    <p style="color: #ef4444; font-weight: bold;">Bu √ºr√ºn sistemde bulunamadƒ±.</p>
                    <button class="btn btn-primary" onclick="switchToCreateMode()">+ Yeni √úr√ºn Olu≈ütur</button>
                </div>

            </div>
        </div>
    </div>
    <script src="/js/utils.js"></script>
    <script src="/js/products_v2.js?v=9.26"></script>
</body>

</html>